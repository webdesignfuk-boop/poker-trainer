<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸƒ ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ  ãƒãƒ¼ã‚«ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        h1 {
            text-align: center;
            padding: 15px 10px;
            font-size: clamp(1.2rem, 4vw, 2rem);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        /* ã‚¢ãƒã‚¿ãƒ¼é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« */
        .avatar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .avatar-modal.active {
            display: flex;
        }
        
        .avatar-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            width: 100%;
            max-width: 500px;
        }
        
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .avatar-option {
            font-size: 2.5rem;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 3px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .avatar-option:hover, .avatar-option.selected {
            border-color: #ffd700;
            background: rgba(255,215,0,0.2);
            transform: scale(1.1);
        }
        
        /* ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
        .game-area {
            background: rgba(10, 95, 56, 0.95);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 15px;
        }
        
        /* ãƒãƒƒãƒˆæƒ…å ± */
        .pot-info {
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰ */
        .community-cards {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            min-height: 100px;
            align-items: center;
        }
        
        .card {
            width: clamp(50px, 12vw, 70px);
            height: clamp(70px, 16vw, 100px);
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            color: #000;
            animation: cardDeal 0.5s ease-out;
        }
        
        @keyframes cardDeal {
            from {
                transform: translateY(-100px) rotateY(180deg);
                opacity: 0;
            }
            to {
                transform: translateY(0) rotateY(0);
                opacity: 1;
            }
        }
        
        .card.red {
            color: #e74c3c;
        }
        
        .card.back {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            font-size: clamp(1.5rem, 5vw, 2rem);
        }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ç½® */
        .players-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        @media (min-width: 768px) {
            .players-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .player {
            background: rgba(0,0,0,0.8);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 12px;
            position: relative;
            transition: all 0.3s;
        }
        
        .player.human {
            border-color: #00ff00;
            grid-column: 1 / -1;
        }
        
        .player.folded {
            opacity: 0.4;
            border-color: #888;
        }
        
        .player.active {
            box-shadow: 0 0 20px rgba(255,215,0,0.6);
            animation: glow 1s infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.6); }
            50% { box-shadow: 0 0 30px rgba(255,215,0,0.9); }
        }
        
        .player-avatar {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            text-align: center;
        }
        
        .player-chips, .player-bet {
            text-align: center;
            margin-bottom: 6px;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }
        
        .player-chips {
            color: #ffd700;
        }
        
        .player-bet {
            color: #ff6b6b;
        }
        
        .player-hand {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .player-hand .card {
            width: clamp(40px, 10vw, 50px);
            height: clamp(56px, 14vw, 70px);
            font-size: clamp(1rem, 3vw, 1.2rem);
        }
        
        .player-action {
            text-align: center;
            color: #4ecdc4;
            font-size: 0.85rem;
            margin-top: 5px;
            min-height: 20px;
            font-weight: bold;
        }
        
        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0 10px 0;
            padding: 0 5px;
        }
        
        @media (min-width: 480px) {
            .action-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        button {
            padding: clamp(12px, 3vw, 18px);
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            touch-action: manipulation;
            min-height: 50px;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-fold {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn-check {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }
        
        .btn-call {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-raise {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            grid-column: 1 / -1;
        }
        
        /* ãƒ™ãƒƒãƒˆèª¿æ•´ */
        .bet-controls {
            background: rgba(0,0,0,0.6);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #ffd700;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .bet-amount-display {
            text-align: center;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .bet-quick-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .bet-quick-btn {
            padding: 8px;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            color: white;
        }
        
        /* ã‚²ãƒ¼ãƒ ãƒ­ã‚° */
        .game-log {
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‘ãƒãƒ« */
        .feedback-panel {
            background: rgba(0,0,0,0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .feedback-section h3 {
            color: #ffd700;
            margin-bottom: 12px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 8px;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }
        
        @media (min-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: bold;
            color: #ffd700;
        }
        
        .feedback-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }
        
        .feedback-item.good { border-left: 4px solid #2ecc71; }
        .feedback-item.bad { border-left: 4px solid #e74c3c; }
        .feedback-item.suggestion { border-left: 4px solid #3498db; }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            width: 100%;
        }
        
        .winner-announcement {
            text-align: center;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: #ffd700;
            margin-bottom: 20px;
            animation: celebration 1s infinite;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }
        
        /* ã‚µã‚¦ãƒ³ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .sound-control {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #ffd700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="sound-control" onclick="toggleSound()" id="sound-btn">ğŸ”Š</div>
    
    <div class="avatar-modal" id="avatar-modal">
        <div class="avatar-content">
            <h2 style="text-align: center; margin-bottom: 20px;">ã‚¢ãƒã‚¿ãƒ¼ã‚’é¸æŠ</h2>
            <div class="avatar-grid">
                <div class="avatar-option" onclick="selectAvatar('ğŸ¤ ')">ğŸ¤ </div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ˜')">ğŸ˜</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ§')">ğŸ§</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ˜ˆ')">ğŸ˜ˆ</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ¤–')">ğŸ¤–</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘‘')">ğŸ‘‘</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ©')">ğŸ©</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ¥·')">ğŸ¥·</div>
            </div>
            <button class="btn-primary" onclick="closeAvatarModal()">æ±ºå®š</button>
        </div>
    </div>
    
    <div class="container">
        <h1>ğŸƒ ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ  ãƒãƒ¼ã‚«ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼</h1>
        
        <div class="game-area">
            <div class="pot-info">ğŸ’° Pot: $<span id="pot-amount">0</span></div>
            
            <div class="community-cards" id="community-cards"></div>
            
            <div class="players-container" id="players-container"></div>
            
            <div class="action-buttons" id="action-buttons">
                <button class="btn-primary" onclick="showAvatarModal()">ã‚¢ãƒã‚¿ãƒ¼é¸æŠ</button>
                <button class="btn-primary" onclick="startNewHand()">æ–°ã—ã„ãƒãƒ³ãƒ‰ã‚’é–‹å§‹</button>
            </div>
            
            <div class="bet-controls" id="bet-controls" style="display: none;">
                <label style="display: block; text-align: center; margin-bottom: 10px;">ãƒ¬ã‚¤ã‚ºé¡</label>
                <input type="range" id="raise-slider" min="20" max="1000" step="10" value="50">
                <div class="bet-amount-display">$<span id="raise-amount">50</span></div>
                <div class="bet-quick-buttons">
                    <button class="bet-quick-btn" onclick="setRaiseAmount(0.5)">50%</button>
                    <button class="bet-quick-btn" onclick="setRaiseAmount(0.75)">75%</button>
                    <button class="bet-quick-btn" onclick="setRaiseAmount(1)">ãƒãƒƒãƒˆ</button>
                    <button class="bet-quick-btn" onclick="setRaiseAmount(2)">ALL IN</button>
                </div>
            </div>
            
            <div class="game-log" id="game-log">
                <div class="log-entry">ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€Œæ–°ã—ã„ãƒãƒ³ãƒ‰ã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ ğŸ°</div>
            </div>
        </div>
        
        <div class="feedback-panel" id="feedback-panel" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“Š ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h2>
            <div class="feedback-section">
                <h3>çµ±è¨ˆæƒ…å ±</h3>
                <div class="stats-grid" id="stats-grid"></div>
            </div>
            <div class="feedback-section">
                <h3>âœ… è‰¯ã‹ã£ãŸãƒ—ãƒ¬ã‚¤</h3>
                <ul class="feedback-list" id="good-plays" style="list-style: none; padding: 0;"></ul>
            </div>
            <div class="feedback-section">
                <h3>âš ï¸ æ”¹å–„ãŒå¿…è¦ãªãƒ—ãƒ¬ã‚¤</h3>
                <ul class="feedback-list" id="bad-plays" style="list-style: none; padding: 0;"></ul>
            </div>
            <div class="feedback-section">
                <h3>ğŸ’¡ ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h3>
                <ul class="feedback-list" id="suggestions" style="list-style: none; padding: 0;"></ul>
            </div>
            <button class="btn-primary" onclick="startNewHand()">æ¬¡ã®ãƒãƒ³ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤</button>
        </div>
    </div>
    
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="winner-announcement" id="winner-text"></div>
            <div id="result-details"></div>
            <button class="btn-primary" onclick="closeModal()">ç¶šã‘ã‚‹</button>
        </div>
    </div>
    
    <script>
        let gameState = {};
        let soundEnabled = true;
        let playerAvatar = 'ğŸ˜';
        const aiAvatars = {'ãƒ‰ãƒŠãƒ«ãƒ‰': 'ğŸ¦…', 'ã‚¦ãƒ©ã‚¸ãƒ¼ãƒŸãƒ«': 'ğŸ»', 'è¿‘å¹³': 'ğŸ¼'};
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (!soundEnabled) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            if (type === 'card') {
                osc.frequency.value = 440;
                gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                osc.start(); osc.stop(audioContext.currentTime + 0.1);
            } else if (type === 'chip') {
                osc.frequency.value = 880;
                gain.gain.setValueAtTime(0.15, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                osc.start(); osc.stop(audioContext.currentTime + 0.2);
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-btn').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        function showAvatarModal() {
            document.getElementById('avatar-modal').classList.add('active');
        }
        
        function closeAvatarModal() {
            document.getElementById('avatar-modal').classList.remove('active');
            updatePlayerDisplay();
        }
        
        function selectAvatar(emoji) {
            playerAvatar = emoji;
            document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
        }
        
        function addLog(msg) {
            const log = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = msg;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function displayCard(cardStr) {
            const card = document.createElement('div');
            card.className = 'card';
            if (cardStr.includes('â™¥') || cardStr.includes('â™¦')) card.classList.add('red');
            card.textContent = cardStr;
            playSound('card');
            return card;
        }
        
        function updatePlayerDisplay() {
            const container = document.getElementById('players-container');
            container.innerHTML = '';
            
            Object.entries(gameState.players || {}).forEach(([name, player]) => {
                const div = document.createElement('div');
                div.className = 'player';
                if (name === 'You') div.classList.add('human');
                if (player.is_folded) div.classList.add('folded');
                
                const avatar = name === 'You' ? playerAvatar : (aiAvatars[name] || 'ğŸ¤–');
                div.innerHTML = `
                    <div class="player-avatar">${avatar}</div>
                    <div class="player-name">${name}</div>
                    <div class="player-chips">ğŸ’° $${player.chips}</div>
                    <div class="player-bet">ğŸ² Bet: $${player.current_bet}</div>
                    <div class="player-hand" id="hand-${name.replace(/\s/g,'')}"></div>
                    <div class="player-action" id="action-${name.replace(/\s/g,'')}"></div>
                `;
                container.appendChild(div);
                
                const handDiv = div.querySelector('.player-hand');
                if (player.hand && player.hand.length > 0) {
                    player.hand.forEach(card => handDiv.appendChild(displayCard(card)));
                } else if (!player.is_folded && name !== 'You') {
                    for (let i = 0; i < 2; i++) {
                        const back = document.createElement('div');
                        back.className = 'card back';
                        back.textContent = 'ğŸ‚ ';
                        handDiv.appendChild(back);
                    }
                }
            });
        }
        
        function updateGameState(data) {
            // ç ´ç”£ãƒã‚§ãƒƒã‚¯
            if (data.bankrupt) {
                setTimeout(() => {
                    playSound('win');
                    const modal = document.getElementById('result-modal');
                    const winnerText = document.getElementById('winner-text');
                    const detailsDiv = document.getElementById('result-details');
                    
                    winnerText.textContent = 'ğŸ’¸ ã‚²ãƒ¼ãƒ çµ‚äº†';
                    detailsDiv.innerHTML = `
                        <p style="text-align: center; font-size: 1.2rem; margin: 20px 0;">
                            ãƒãƒƒãƒ—ãŒãªããªã‚Šã¾ã—ãŸï¼
                        </p>
                        <p style="text-align: center; margin: 15px 0;">
                            ${data.message || 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¾ã™ã‹ï¼Ÿ'}
                        </p>
                    `;
                    
                    // ãƒœã‚¿ãƒ³ã‚’ã€Œæ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã€ã«å¤‰æ›´
                    const modalButton = modal.querySelector('button');
                    modalButton.textContent = 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹';
                    modalButton.onclick = () => location.reload();
                    
                    modal.classList.add('active');
                    
                    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    document.getElementById('action-buttons').innerHTML = '<button class="btn-primary" onclick="location.reload()">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</button>';
                }, 500);
                return;
            }
            
            document.getElementById('pot-amount').textContent = data.pot;
            const comm = document.getElementById('community-cards');
            comm.innerHTML = '';
            if (data.community_cards) {
                data.community_cards.forEach((card, i) => {
                    setTimeout(() => comm.appendChild(displayCard(card)), i * 200);
                });
            }
            gameState = data;
            updatePlayerDisplay();
        }
        
        function setRaiseAmount(mult) {
            const pot = gameState.pot || 0;
            const chips = gameState.players?.['You']?.chips || 1000;
            const amt = mult === 2 ? chips : Math.min(Math.floor(pot * mult), chips);
            document.getElementById('raise-slider').value = amt;
            document.getElementById('raise-amount').textContent = amt;
        }
        
        async function startNewHand() {
            try {
                document.getElementById('feedback-panel').style.display = 'none';
                addLog('ğŸ´ æ–°ã—ã„ãƒãƒ³ãƒ‰ã‚’é–‹å§‹...');
                const res = await fetch('/api/start_hand', {method: 'POST'});
                const data = await res.json();
                updateGameState(data);
                addLog('âœ… ãƒãƒ³ãƒ‰é–‹å§‹ï¼');
                setTimeout(() => showPlayerActions(data), 1000);
            } catch (e) {
                addLog('âŒ ã‚¨ãƒ©ãƒ¼');
            }
        }
        
        function showPlayerActions(data) {
            const btns = document.getElementById('action-buttons');
            btns.innerHTML = '';
            const callAmt = data.current_bet - (data.players['You']?.current_bet || 0);
            
            const fold = document.createElement('button');
            fold.className = 'btn-fold';
            fold.textContent = 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰';
            fold.onclick = () => playerAction('fold', 0);
            btns.appendChild(fold);
            
            if (callAmt === 0) {
                const check = document.createElement('button');
                check.className = 'btn-check';
                check.textContent = 'ãƒã‚§ãƒƒã‚¯';
                check.onclick = () => playerAction('check', 0);
                btns.appendChild(check);
            } else {
                const call = document.createElement('button');
                call.className = 'btn-call';
                call.textContent = `ã‚³ãƒ¼ãƒ« $${callAmt}`;
                call.onclick = () => playerAction('call', callAmt);
                btns.appendChild(call);
            }
            
            const raise = document.createElement('button');
            raise.className = 'btn-raise';
            raise.textContent = 'ãƒ¬ã‚¤ã‚º';
            raise.onclick = () => playerAction('raise', parseInt(document.getElementById('raise-slider').value));
            btns.appendChild(raise);
            
            document.getElementById('bet-controls').style.display = 'block';
            const slider = document.getElementById('raise-slider');
            slider.min = Math.max(20, callAmt * 2);
            slider.max = data.players['You']?.chips || 1000;
            slider.value = Math.min(100, slider.max);
            slider.oninput = function() {
                document.getElementById('raise-amount').textContent = this.value;
            };
            document.getElementById('raise-amount').textContent = slider.value;
        }
        
        async function playerAction(action, amount) {
            try {
                playSound('chip');
                const res = await fetch('/api/player_action', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action, amount})
                });
                const data = await res.json();
                const txt = action === 'fold' ? 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰' : action === 'check' ? 'ãƒã‚§ãƒƒã‚¯' : 
                           action === 'call' ? `ã‚³ãƒ¼ãƒ« $${amount}` : `ãƒ¬ã‚¤ã‚º $${amount}`;
                addLog(`ã‚ãªãŸ: ${txt}`);
                updateGameState(data);
                
                if (data.game_over) {
                    setTimeout(() => showResult(data.result), 500);
                } else if (data.hand_complete) {
                    setTimeout(proceedToNextStreet, 1000);
                } else {
                    setTimeout(processAIActions, 1000);
                }
            } catch (e) {
                addLog('âŒ ã‚¨ãƒ©ãƒ¼');
            }
        }
        
        async function processAIActions() {
            try {
                const res = await fetch('/api/process_ai');
                const data = await res.json();
                
                if (data.actions) {
                    for (const act of data.actions) {
                        playSound('chip');
                        const txt = act.action === 'fold' ? 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰' : act.action === 'check' ? 'ãƒã‚§ãƒƒã‚¯' :
                                   act.action === 'call' ? `ã‚³ãƒ¼ãƒ« $${act.amount}` : `ãƒ¬ã‚¤ã‚º $${act.amount}`;
                        addLog(`${act.player}: ${txt}`);
                        await new Promise(r => setTimeout(r, 800));
                    }
                }
                
                updateGameState(data);
                
                if (data.game_over) {
                    setTimeout(() => showResult(data.result), 500);
                } else if (data.waiting_for_player) {
                    showPlayerActions(data);
                } else if (data.hand_complete) {
                    setTimeout(proceedToNextStreet, 1000);
                }
            } catch (e) {}
        }
        
        async function proceedToNextStreet() {
            try {
                const res = await fetch('/api/next_street', {method: 'POST'});
                const data = await res.json();
                const names = {'flop': 'ãƒ•ãƒ­ãƒƒãƒ—', 'turn': 'ã‚¿ãƒ¼ãƒ³', 'river': 'ãƒªãƒãƒ¼'};
                addLog(`ğŸ´ --- ${names[data.street] || data.street.toUpperCase()} ---`);
                updateGameState(data);
                
                if (data.game_over) {
                    setTimeout(() => showResult(data.result), 500);
                } else {
                    setTimeout(() => showPlayerActions(data), 1000);
                }
            } catch (e) {}
        }
        
        function showResult(result) {
            playSound('win');
            const modal = document.getElementById('result-modal');
            document.getElementById('winner-text').textContent = `ğŸ‰ ${result.winner} ãŒå‹åˆ©ï¼`;
            
            let html = `<p style="text-align: center; font-size: 1.2rem;">ç²å¾—ãƒãƒƒãƒˆ: $${result.pot}</p>`;
            if (result.winning_hand) {
                html += `<p style="text-align: center; font-size: 1.1rem; color: #ffd700;">å½¹: ${result.winning_hand}</p>`;
            }
            
            if (result.all_hands) {
                html += '<h3 style="margin-top: 20px;">å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒãƒ³ãƒ‰:</h3>';
                result.all_hands.forEach(h => {
                    html += `<p><strong>${h.player}:</strong> ${h.hand.join(', ')} - ${h.hand_name}</p>`;
                });
            }
            
            document.getElementById('result-details').innerHTML = html;
            modal.classList.add('active');
            setTimeout(loadFeedback, 500);
        }
        
        function closeModal() {
            document.getElementById('result-modal').classList.remove('active');
        }
        
        async function loadFeedback() {
            try {
                const res = await fetch('/api/feedback');
                const data = await res.json();
                
                document.getElementById('stats-grid').innerHTML = `
                    <div class="stat-box"><div class="stat-label">ç·ãƒãƒ³ãƒ‰æ•°</div><div class="stat-value">${data.statistics.total_hands}</div></div>
                    <div class="stat-box"><div class="stat-label">VPIP</div><div class="stat-value">${data.statistics.vpip}%</div></div>
                    <div class="stat-box"><div class="stat-label">å‹ç‡</div><div class="stat-value">${data.statistics.win_rate}%</div></div>
                    <div class="stat-box"><div class="stat-label">ç·åˆ©ç›Š</div><div class="stat-value">$${data.statistics.total_profit}</div></div>
                `;
                
                const good = document.getElementById('good-plays');
                good.innerHTML = data.overall_assessment.strengths.length ? 
                    data.overall_assessment.strengths.map(s => `<li class="feedback-item good">${s}</li>`).join('') :
                    '<li class="feedback-item">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</li>';
                
                const bad = document.getElementById('bad-plays');
                bad.innerHTML = data.overall_assessment.weaknesses.length ?
                    data.overall_assessment.weaknesses.map(w => `<li class="feedback-item bad">${w}</li>`).join('') :
                    '<li class="feedback-item">å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼</li>';
                
                const sug = document.getElementById('suggestions');
                sug.innerHTML = data.overall_assessment.recommendations.length ?
                    data.overall_assessment.recommendations.map(r => `<li class="feedback-item suggestion">${r}</li>`).join('') :
                    '<li class="feedback-item">ç´ æ™´ã‚‰ã—ã„ãƒ—ãƒ¬ã‚¤ã§ã™ï¼</li>';
                
                document.getElementById('feedback-panel').style.display = 'block';
            } catch (e) {}
        }
        
        window.onload = function() {
            addLog('ğŸ° ãƒãƒ¼ã‚«ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã¸ã‚ˆã†ã“ãï¼');
            addLog('ã¾ãšã¯ã‚¢ãƒã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ã€ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼');
        };
    </script>
</body>
</html>
